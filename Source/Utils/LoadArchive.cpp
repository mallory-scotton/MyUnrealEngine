///////////////////////////////////////////////////////////////////////////////
// Dependencies
///////////////////////////////////////////////////////////////////////////////
#include "Utils/LoadArchive.hpp"
#include "Utils/Maths.hpp"
#include <string.h>

///////////////////////////////////////////////////////////////////////////////
// Namespace TKD
///////////////////////////////////////////////////////////////////////////////
namespace TKD
{

///////////////////////////////////////////////////////////////////////////////
LoadArchive::LoadArchive(const TVector<FUint8>& data)
    : Archive()
    , mData(data)
    , mPosition(0)
{
    mIsLoading = true;
    mAllowSeek = true;
}

///////////////////////////////////////////////////////////////////////////////
void LoadArchive::Seek(FUint64 position)
{
    mPosition = Math::Min(position, mData.size());
}

///////////////////////////////////////////////////////////////////////////////
FUint64 LoadArchive::Tell(void) const
{
    return (mPosition);
}

///////////////////////////////////////////////////////////////////////////////
FUint64 LoadArchive::TotalSize(void) const
{
    return (mData.size());
}

///////////////////////////////////////////////////////////////////////////////
void LoadArchive::Serialize(void* data, FUint64 length)
{
    if (length == 0 || mPosition >= mData.size()) {
        return;
    }
    FUint64 bytesToRead = Math::Min(length, mData.size() - mPosition);

    ::memcpy(data, &mData[mPosition], bytesToRead);
    mPosition += bytesToRead;

    if (bytesToRead < length) {
        ::memset((FUint8*)data + bytesToRead, 0, length - bytesToRead);
    }
}

} // !namespace TKD

///////////////////////////////////////////////////////////////////////////////
// Header guard
///////////////////////////////////////////////////////////////////////////////
#pragma once

///////////////////////////////////////////////////////////////////////////////
// Dependencies
///////////////////////////////////////////////////////////////////////////////
#include "GraphEditor/Core/UNode.hpp"
#include "GraphEditor/Core/UEvaluationContext.hpp"
#include "GraphEditor/Nodes/Templates.hpp"

///////////////////////////////////////////////////////////////////////////////
// Namespace UEB::Nodes
///////////////////////////////////////////////////////////////////////////////
namespace UEB::Nodes
{

///////////////////////////////////////////////////////////////////////////////
/// \brief
///
///////////////////////////////////////////////////////////////////////////////
class BranchNode : public UNode
{
public:
    ///////////////////////////////////////////////////////////////////////////
    /// \brief
    ///
    ///////////////////////////////////////////////////////////////////////////
    BranchNode(void)
        : UNode(
            "Branch",
            Type::Blueprint,
            ImColor(255, 255, 255),
            NodeIcon::Branch
        )
    {
        AddInputPin(UPin::Type::Flow);
        AddInputPin(UPin::Type::Boolean, "Condition");
        AddOutputPin(UPin::Type::Flow, "True");
        AddOutputPin(UPin::Type::Flow, "False");
    }

public:
    ///////////////////////////////////////////////////////////////////////////
    /// \brief
    ///
    /// \param context
    ///
    ///////////////////////////////////////////////////////////////////////////
    void Evaluate(UEvaluationContext& context) override
    {
        bool flow = context.template GetPinValue<bool>(mInputs[0]);
        bool condition = context.template GetPinValue<bool>(mInputs[1]);

        if (flow) {
            context.template SetPinValue<bool>(mOutputs[0], condition);
            context.template SetPinValue<bool>(mOutputs[1], !condition);
        } else {
            context.template SetPinValue<bool>(mOutputs[0], false);
            context.template SetPinValue<bool>(mOutputs[1], false);
        }
    }
};

///////////////////////////////////////////////////////////////////////////////
/// \brief
///
///////////////////////////////////////////////////////////////////////////////
class SequenceNode : public UNode
{
public:
    ///////////////////////////////////////////////////////////////////////////
    /// \brief
    ///
    ///////////////////////////////////////////////////////////////////////////
    SequenceNode(void)
        : UNode(
            "Sequence",
            Type::Blueprint,
            ImColor(255, 255, 255),
            NodeIcon::Sequence
        )
    {
        AddInputPin(UPin::Type::Flow);
        AddOutputPin(UPin::Type::Flow, "Then 0");
        AddOutputPin(UPin::Type::Flow, "Then 1");
    }

public:
    ///////////////////////////////////////////////////////////////////////////
    /// \brief
    ///
    /// \param context
    ///
    ///////////////////////////////////////////////////////////////////////////
    void Evaluate(UEvaluationContext& context) override
    {
        bool flow = context.template GetPinValue<bool>(mInputs[0]);

        for (auto& output : mOutputs) {
            context.template SetPinValue<bool>(output, flow);
        }
    }
};

} // !namespace UEB::Nodes
